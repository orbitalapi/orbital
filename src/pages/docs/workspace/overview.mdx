import PublishingFromSources from './publshing-from-sources.png'
import { ImageWithCaption } from "@/components/ImageWithCaption";
import {SnippetGroup} from '@/components/SnippetGroup'

export const meta = {
  title: 'Overview',
  pageTitle: 'Workspace - Overview',
  description: 'An overview of how to connect data sources to Orbital'
}

An Orbital Workspace is a collection of schemas, API specs and Taxi projects that describe 
data sources (APIs, Databases, Message queues and Serverless functions) provide a description
of the data and capabilities they provide.

These descriptions are used to generate integration on-the-fly, and power your data catalog.

Data sources are described using some form of API spec language (Protobuf, OpenAPI, Avro, Taxi), along with
additional metadata that defines how concepts are related semantically.

There's lots of different ways to tell Orbital about your data sources - we believe that Orbital should fit with
the way you work today.

## Components

Generally there's at least the following components:

 * A taxonomy project (built using Taxi) that defines the terms embedded in your API contracts.  This is most commonly stored in Git, or locally on your machine (when you're first getting started).
 * A series of API specs, enriched with metadata using terms from your Taxonomy project.

<ImageWithCaption src={PublishingFromSources.src} addLightBackground={true} />


### Your core taxonomy
The core taxonomy is a collection of terms that describe your data attributes.  Think of them
as simple tags, which describe your data - such as `FirstName`, `LastName`, etc.

These tags provide
In practice, these tags are actually semantic types, defined using [Taxi](https://taxilang.org).

```taxi
type FirstName inherits String
type LastName inherits String
type CustomerId inherits Int
```

By using Taxi, you get the benefit of a full type system, rich build tooling to verify correctness, and an
open source ecosystem to build your own plugins.

A common pattern for building a core taxonomy is:

 * Created as a standalone project, independent of any specific API / Service
 * Lives in a Git repository
 * Orbital [monitors the git repository](/docs/connecting-data-sources/connecting-a-git-repo) and automatically deploys changes.

### Services and data Sources
Services and data sources are described using existing API specs (OpenAPI / Protobuf / Json Schema, etc), enriched
with semantic tags from [your core taxonomy](#your-core-taxonomy).

<SnippetGroup>

```yml ShoppingCart OpenAPI Spec
   # An extract of the ShoppingCartApi OpenAPI spec:
   components:  
     schemas:  
       ShoppingCart:  
         properties:  
           custId:   # Field name
             x-taxi-type:  
>              name: CustomerId  # <-- Semantic type
             type: string  
```

```protobuf Example.proto   
  import "org/taxilang/dataType.proto";

   message Customer {
      optional string customer_name = 1 [(taxi.dataType)="CustomerName"];
>     optional int32 customer_id = 2 [(taxi.dataType)="CustomerId"];
   }
```

</SnippetGroup>

For more information, follow our guides on using [OpenApi](/docs/describing-data-sources/open-api) or [Protobuf](/docs/describing-data-sources/protobuf) to describe your data sources.

#### Using Taxi
Another option is authoring your API specs directly in [Taxi](/docs/describing-data-sources/taxi):

```taxi
model Customer {
  id : CustomerId inherits Int
  firstName : CustomerFirstName inherits Sring
}

service CustomerService {
  @HttpOperation(method = "GET", url = "/shoppingCart/{CustomerId}")
  operation getShoppingCartByCustomerId(CustomerId):ShoppingCart
}
```



Alternatively, you can just generate schema definitions directly from code, or author your definitions in Taxi.

Once you choose how to describe your services, you simply need to [publish](#publishing-and-updating) your specs to Orbital

## Publishing and updating your specs
How and when you choose to publish / update these sources is up to you - teams tend to have different preferences around this.

You're also free to mix and match - to pick the publication method that best works for your tech and team working style.

The following publication methods are available:

 * Pushing API specs to Orbital (eg., when your microservices start)
 * Pushing updates to Orbital manually (eg., within a CI/CD pipeline)
 * Having Orbital poll sources for changes

### Pushing API specs directly from your apps
Applications can generate Taxi, direct from code, and publish to Orbital.

 * Suits microservices and teams who prefer generating their API specs from code
 * Currently only Java / Kotlin with Spring Boot is supported, but other SDKs are planned - [reach out](https://github.com/orbitalapi/orbital/discussions) to tell us about your usecase.


Learn more about this approach [here](./schema-publication-methods)

<!-- TODO: Flesh this out -->
<!-- ### Pushing updates to Orbital manually (CI/CD)
Data sources can publish updated specs to Orbital manually, using our CLI, or direct to our API.  This is a good fit
for teams that choose to push updates as part of a CI/CD cycle.

 * Suits teams who publish API specs during a CI/CD job

Learn more about this approach [here](./publishing-direct-to-orbital) -->


### Pulling API specs from Orbital

Orbital can be configured to fetch API specs (projects) from either Git repositories
or the file system where Orbital is running (intended for local development).

In addition to storing your [core taxonomy](#your-core-taxonomy) in Git, you can fetch other API specs (such as Protobuf or OpenApi) from
a git repository.

Orbital will poll your git repo, and automatically update as changes are merged into your target branch.

For more information, read about [pulling API specs from git](./connecting-a-git-repo) or [reading API specs from local disk](./connecting-a-disk-repo)

## Workspace.conf file
The `workspace.conf` file is a HOCON file that describes all the locations to pull code from.  (Data sources that
are [pushing their API specs](#pushing-api-specs-directly-from-your-apps) are not included.)

Schemas can be pulled from multiple different formats and approaches.  The configuration for these
repositories is defined in a [HOCON](https://github.com/lightbend/config#examples-of-hocon) format file.

### Passing a workspace.conf file
By default, the configuration file is called `workspace.conf`.  However, the location of the file can be changed by setting `--vyne.workspace.config-file=/path/to/workspace.conf`
on the command line, or through any of the supported configuration overriding mechanisms.

### Using a single-project workspace
For demos / test config, it's sometimes useful to start Orbital with a single project configured.

You can by-pass the workspace config, and point Orbital directly to a single local file-system project.

To do this, start Orbital's schema server with `--vyne.workspace.project-file=/path/to/taxi.conf`


### Configuration conventions
Durations are defined using [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601#Durations) formats.  For example:
 * 1 Day = `P1D`
 * 3 Seconds = `PT3S`

### Kitchen sink configuration example

```json5
file {
   changeDetectionMethod=WATCH
   incrementVersionOnChange=false
   paths=[
      "/path/to/project"
   ]
   pollFrequency=PT5S
   recompilationFrequencyMillis=PT3S
}
git {
   checkoutRoot="/my/git/root"
   pollFrequency=PT30S
   repositories=[
      {
         branch=master
         name=my-git-project
         uri="https://github.com/something.git"
      }
   ]
}
```
