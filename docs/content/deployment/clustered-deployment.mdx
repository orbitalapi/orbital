---
title: Clustered deployment
description: Configuration for deployment of a hazelcast clustered vyne
---

import { Link } from "gatsby"

Clustering of Vyne server instances allows for distribution of cpu intensive tasks, especially projections.  Vyne services can form a hazelcast cluster
via multicast, aws and eureka discovery mechanisms.  This is especially well suited for queries that return large numbers of records, which need to be projected.
Distributing the work over a cluster provides significant performance improvements, as the work can be parallelized.


## Work Distribution Configuration

For projection work to be distributed across all vyne nodes in a cluster the following configuration options are provided


| Config parameter                | Description                                                                                        | Default setting             |
|---------------------------------|----------------------------------------------------------------------------------------------------|-----------------------------|
| `vyne.projection.distributionMode`               | Defines where projection work will be performed.  On the local node or the cluster LOCAL, HAZELCAST  | `LOCAL`                  |
| `vyne.projection.distributionPacketSize` | Defines the number of records in each work packet distributed to other vyne servers.  Applicable to HAZELCAST distributionMode only  | 100                     |
| `vyne.projection.distributionRemoteBias`     |  Defines the number of cluster members before work is preferentially distributed to remote notes | 10                        |



## Cluster Configuration


| Config parameter                | Description                                                                                        | Default setting             |
|---------------------------------|----------------------------------------------------------------------------------------------------|-----------------------------|
| `vyne.hazelcast.enabled`               | Enable or disable clustering  | `false`              |
| `vyne.hazelcast.discovery` | Specifies the discovery mechanism hazelcast will use to find other instances. multicast, aws or eureka | `multicast`                     |
| `vyne.hazelcast.eurekaUri`     |  URI of the coordinating eureka instance when discovery is set to eureka | `http://127.0.0.1:8761/eureka/`                        |
| `vyne.hazelcast.memberTag`     | Denotes which member type this is within the hazelcast cluster | `vyne-query-service`                        |
| `vyne.hazelcast.networkInterface`     |  Should only be specified if the deployment environment requires that hazelcast only bind to a single network interface.  The network interface supplied should be specified in hazelcast networking naming e.g. 10.10.*.*, 172.16.*.* |                        |
| `vyne.hazelcast.useMetadataForHostAndPort`     |  Specific to eureka hazelcast discovery.  Specifies if metadata should be published to and used for hazelcast node and port discovery  | `true`                        |
| `vyne.hazelcast.awsPortScanRange`     |  Specific to aws hazelcast discovery.  Specifies the port ranges that will be scanned from running hazelcast on ec2 instances | `true`                        |
| `vyne.hazelcast.taskPoolSize`     |  Specifies the number of threads dedicated to processing distributed work loads  | 2                        |
| `vyne.hazelcast.taskQueueSize`     |  Specifies the size of the queue of tasks on each cluster node.  A value of 0 sets an infinite queue size  | 0        |



### Example vyne configurations.

Configure the vyne configuration file with the following attributes

### Simple Multicast
Enable clustering using discovery via local network multicast with distributed projections
```yaml
vyne:
    projection:
        distributionMode: HAZELCAST

    hazelcast:
        enabled: true
        discovery: multicast
```

### AWS
Enable clustering using AWS discovery with distributed projections

The vyne query server should be run on a EC2 instances where AWS_REGION is specified as a environment variable and the EC2 instance is authorised to
query ec2 instances via IAM.

AWS_REGION may alternatively be specified as a JVM property -DAWS_REGION=eu-west_2

```yaml
vyne:
    projection:
        distributionMode: HAZELCAST

    hazelcast:
        enabled: true
        discovery: aws
```

### EUREKA
Enable clustering using EUREKA discovery with distributed projections

```yaml
vyne:
    projection:
        distributionMode: HAZELCAST

    hazelcast:
        enabled: true
        discovery: eureka
        eurekaUri: http://eureka-server:8761/eureka/
        useMetadataForHostAndPort: true
```

