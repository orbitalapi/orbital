{
   "test": "Given a customer email address, discover available rewards",
   "background" : "Explores complex discovery - involves invoking a service to perform a conversion because a subsequent service has an unment constraint",
   "scenario": {
      "query": {
         "expression": [
            "io.vyne.demos.marketing.shop.AvailableRewards"
         ],
         "facts": [
            {
               "typeName": "demo.CustomerEmailAddress",
               "value": "jimmy@demo.com",
               "factSetId": "DEFAULT"
            }
         ],
         "queryMode": "DISCOVER"
      },
      "response": {
         "results": {
            "io.vyne.demos.marketing.shop.AvailableRewards": {
               "typeName": "io.vyne.demos.marketing.shop.AvailableRewards",
               "value": {
                  "rewards": [
                     {
                        "typeName": "io.vyne.demos.marketing.shop.Reward",
                        "value": {
                           "name": {
                              "typeName": "lang.taxi.String",
                              "value": "Weekend at the spa"
                           },
                           "priceInGbp": {
                              "typeName": "lang.taxi.Int",
                              "value": 300
                           }
                        }
                     },
                     {
                        "typeName": "io.vyne.demos.marketing.shop.Reward",
                        "value": {
                           "name": {
                              "typeName": "lang.taxi.String",
                              "value": "Night at the moview"
                           },
                           "priceInGbp": {
                              "typeName": "lang.taxi.Int",
                              "value": 20
                           }
                        }
                     },
                     {
                        "typeName": "io.vyne.demos.marketing.shop.Reward",
                        "value": {
                           "name": {
                              "typeName": "lang.taxi.String",
                              "value": "Bottle of wine"
                           },
                           "priceInGbp": {
                              "typeName": "lang.taxi.Int",
                              "value": 10
                           }
                        }
                     }
                  ]
               }
            }
         },
         "unmatchedNodes": [],
         "path": null,
         "queryResponseId": "52564472-4a20-412a-b24d-349a7564760e",
         "duration": 916,
         "fullyResolved": true,
         "remoteCalls": [
            {
               "service": {
                  "fullyQualifiedName": "io.vyne.demos.rewards.CustomerService",
                  "parameters": [],
                  "namespace": "io.vyne.demos.rewards",
                  "parameterizedName": "io.vyne.demos.rewards.CustomerService",
                  "name": "CustomerService"
               },
               "addresss": "http://martypitt-XPS-15-9560:9200/customers/email/jimmy@demo.com",
               "operation": "getCustomerByEmail",
               "responseTypeName": {
                  "fullyQualifiedName": "demo.Customer",
                  "parameters": [],
                  "namespace": "demo",
                  "parameterizedName": "demo.Customer",
                  "name": "Customer"
               },
               "method": "GET",
               "requestBody": null,
               "resultCode": 200,
               "durationMs": 4,
               "response": {
                  "id": 1,
                  "name": "Jimmy",
                  "email": "jimmy@demo.com",
                  "postcode": "SW11"
               },
               "operationQualifiedName": {
                  "fullyQualifiedName": "io.vyne.demos.rewards.CustomerService@@getCustomerByEmail",
                  "parameters": [],
                  "namespace": "io.vyne.demos.rewards",
                  "parameterizedName": "io.vyne.demos.rewards.CustomerService@@getCustomerByEmail",
                  "name": "CustomerService@@getCustomerByEmail"
               }
            },
            {
               "service": {
                  "fullyQualifiedName": "io.vyne.demos.marketing.MarketingService",
                  "parameters": [],
                  "namespace": "io.vyne.demos.marketing",
                  "parameterizedName": "io.vyne.demos.marketing.MarketingService",
                  "name": "MarketingService"
               },
               "addresss": "http://martypitt-XPS-15-9560:9201/marketing/1",
               "operation": "getMarketingDetailsForCustomer",
               "responseTypeName": {
                  "fullyQualifiedName": "io.vyne.demos.marketing.CustomerMarketingRecord",
                  "parameters": [],
                  "namespace": "io.vyne.demos.marketing",
                  "parameterizedName": "io.vyne.demos.marketing.CustomerMarketingRecord",
                  "name": "CustomerMarketingRecord"
               },
               "method": "GET",
               "requestBody": null,
               "resultCode": 200,
               "durationMs": 4,
               "response": {
                  "id": 1,
                  "rewardsCardNumber": "4005-2003-2330-1002"
               },
               "operationQualifiedName": {
                  "fullyQualifiedName": "io.vyne.demos.marketing.MarketingService@@getMarketingDetailsForCustomer",
                  "parameters": [],
                  "namespace": "io.vyne.demos.marketing",
                  "parameterizedName": "io.vyne.demos.marketing.MarketingService@@getMarketingDetailsForCustomer",
                  "name": "MarketingService@@getMarketingDetailsForCustomer"
               }
            },
            {
               "service": {
                  "fullyQualifiedName": "io.vyne.demos.rewards.balances.RewardsBalanceService",
                  "parameters": [],
                  "namespace": "io.vyne.demos.rewards.balances",
                  "parameterizedName": "io.vyne.demos.rewards.balances.RewardsBalanceService",
                  "name": "RewardsBalanceService"
               },
               "addresss": "http://martypitt-XPS-15-9560:9202/balances/4005-2003-2330-1002",
               "operation": "getRewardsBalance",
               "responseTypeName": {
                  "fullyQualifiedName": "demo.RewardsAccountBalance",
                  "parameters": [],
                  "namespace": "demo",
                  "parameterizedName": "demo.RewardsAccountBalance",
                  "name": "RewardsAccountBalance"
               },
               "method": "GET",
               "requestBody": null,
               "resultCode": 200,
               "durationMs": 5,
               "response": {
                  "cardNumber": "4005-2003-2330-1002",
                  "balance": 2300,
                  "currencyUnit": "POINTS"
               },
               "operationQualifiedName": {
                  "fullyQualifiedName": "io.vyne.demos.rewards.balances.RewardsBalanceService@@getRewardsBalance",
                  "parameters": [],
                  "namespace": "io.vyne.demos.rewards.balances",
                  "parameterizedName": "io.vyne.demos.rewards.balances.RewardsBalanceService@@getRewardsBalance",
                  "name": "RewardsBalanceService@@getRewardsBalance"
               }
            },
            {
               "service": {
                  "fullyQualifiedName": "io.vyne.demos.rewards.balances.RewardsBalanceService",
                  "parameters": [],
                  "namespace": "io.vyne.demos.rewards.balances",
                  "parameterizedName": "io.vyne.demos.rewards.balances.RewardsBalanceService",
                  "name": "RewardsBalanceService"
               },
               "addresss": "http://martypitt-XPS-15-9560:9202/balances/GBP",
               "operation": "convert",
               "responseTypeName": {
                  "fullyQualifiedName": "demo.RewardsAccountBalance",
                  "parameters": [],
                  "namespace": "demo",
                  "parameterizedName": "demo.RewardsAccountBalance",
                  "name": "RewardsAccountBalance"
               },
               "method": "POST",
               "requestBody": {
                  "cardNumber": "4005-2003-2330-1002",
                  "balance": 2300,
                  "currencyUnit": "POINTS"
               },
               "resultCode": 200,
               "durationMs": 60,
               "response": {
                  "cardNumber": "4005-2003-2330-1002",
                  "balance": 1150,
                  "currencyUnit": "GBP"
               },
               "operationQualifiedName": {
                  "fullyQualifiedName": "io.vyne.demos.rewards.balances.RewardsBalanceService@@convert",
                  "parameters": [],
                  "namespace": "io.vyne.demos.rewards.balances",
                  "parameterizedName": "io.vyne.demos.rewards.balances.RewardsBalanceService@@convert",
                  "name": "RewardsBalanceService@@convert"
               }
            },
            {
               "service": {
                  "fullyQualifiedName": "io.vyne.demos.marketing.shop.RewardsShopService",
                  "parameters": [],
                  "namespace": "io.vyne.demos.marketing.shop",
                  "parameterizedName": "io.vyne.demos.marketing.shop.RewardsShopService",
                  "name": "RewardsShopService"
               },
               "addresss": "http://martypitt-XPS-15-9560:9205/shop",
               "operation": "getAvailableRewards",
               "responseTypeName": {
                  "fullyQualifiedName": "io.vyne.demos.marketing.shop.AvailableRewards",
                  "parameters": [],
                  "namespace": "io.vyne.demos.marketing.shop",
                  "parameterizedName": "io.vyne.demos.marketing.shop.AvailableRewards",
                  "name": "AvailableRewards"
               },
               "method": "POST",
               "requestBody": {
                  "cardNumber": "4005-2003-2330-1002",
                  "balance": 1150,
                  "currencyUnit": "GBP"
               },
               "resultCode": 200,
               "durationMs": 823,
               "response": {
                  "rewards": [
                     {
                        "name": "Weekend at the spa",
                        "priceInGbp": 300
                     },
                     {
                        "name": "Night at the moview",
                        "priceInGbp": 20
                     },
                     {
                        "name": "Bottle of wine",
                        "priceInGbp": 10
                     }
                  ]
               },
               "operationQualifiedName": {
                  "fullyQualifiedName": "io.vyne.demos.marketing.shop.RewardsShopService@@getAvailableRewards",
                  "parameters": [],
                  "namespace": "io.vyne.demos.marketing.shop",
                  "parameterizedName": "io.vyne.demos.marketing.shop.RewardsShopService@@getAvailableRewards",
                  "name": "RewardsShopService@@getAvailableRewards"
               }
            }
         ],
         "timings": {
            "LOOKUP": 0,
            "GRAPH_TRAVERSAL": 17,
            "GRAPH_BUILDING": 1,
            "REMOTE_CALL": 898,
            "ROOT": 32486
         },
         "vyneCost": 18
      },
      "timestamp": "2019-07-06T15:06:06.490Z",
      "id": "52564472-4a20-412a-b24d-349a7564760e"
   }
}
